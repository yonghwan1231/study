<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script src="./js/button.js"></script>
</head>
<body>
  <h4>로컬 텍스트 파일 읽기 (다중 파일 선택)</h4>

  <form>
    <div>
      <input type="file" id="file_uploads" accept=".txt" multiple>
    </div>
    <div class="preview">
      <p></p>
    </div>
  </form>
  <script>

  const input = document.querySelector('input');
  const preview = document.querySelector('.preview');

  input.addEventListener('change', showTextFile);
  //input에 'change' 이벤트가 발생(파일 선택)되면 showTextFile 함수를 실행합니다.

  function showTextFile() {
    const selectedFiles = input.files;
    //파일이 선택되면 input의 'files' property에 'FileList'형태로 선택된 파일 정보가 저장됩니다. 'FileList'는 선택된 'File'의 list 형태입니다.
    const list = document.createElement('ul');
    preview.appendChild(list);
    
    for(const file of selectedFiles) { //선택된 파일 목록에서 파일을 하나씩 꺼내옵니다.
      const listItem = document.createElement('li');

      if(validFileType(file)) { // 현재 검사중인 파일이 text/plain 타입인지를 확인하는 함수
        const summary = document.createElement('div');
        summary.textContent = `파일명 : ${file.name}, 파일 크기 : ${returnFileSize(file.size)}.`; //백틱 안에 스크립트문자를 포함시키려면 ${} 안에 넣어주면 된다. 따옴표 안에는 스크립트문자를 포함시킬 수 없으므로 따옴표를 끝내고 +연산자를 통해 스크립트 문자를 입력해 주었기 때문에 백틱이 더 편리하다.
        const textContents = document.createElement('div');
        
        let reader = new FileReader();
        reader.onload = function () {
          textContents.innerText = reader.result;
        };
        reader.readAsText(file, "UTF-8");
        
        listItem.appendChild(summary);
        listItem.appendChild(textContents);
      } else {
        const message = document.createElement('div');
        message.textContent = `파일명 ${file.name}: .txt 파일을 선택하세요`;
        listItem.appendChild(message);
      }

      list.appendChild(listItem);
    }
  }

  const fileTypes = [
    'text/plain',
  ];

  function validFileType(file) {
    return fileTypes.includes(file.type);
  }

  function returnFileSize(number) {
    if(number < 1024) {
      return number + 'bytes';
    } else if(number > 1024 && number < 1048576) {
      return (number/1024).toFixed(1) + 'KB';
    } else if(number > 1048576) {
      return (number/1048576).toFixed(1) + 'MB';
    }
  } 

  /*
  
  파일이 선택되면

  div 안에 ul 이 추가되고

  li를 하나 생성하고

  선택된 파일 목록을 순회하면서


  (1) 타입이 text/plain 타입인 파일이 체크되면

  파일명 : "현재검사중인 파일이름 / 파일크기 : 현재검사중인 파일크기" 라는 text 가 출력되는 div를 하나 생성하고

  또 다른 div를 하나 만들고

  방금 만든 div 안에다가 선택한 파일의 내용을 텍스트로 가져오고

  가져온 파일의 텍스트를 utf-8로 인코딩하고

  인코딩된 텍스트가 담긴 div 와 파일명,파일크기 텍스트가 담긴 div 를

  아까 생성한 li 안에 추가한다  


  (2) 타입이 text/plain 타입인 파일이 체크되지 않으면

  div를 하나 생성하고

  이 div의 텍스트 영역에 '파일명 {방금선택한 파일명} : .txt파일을 선택하세요' 라는

  경고 메세지를 아까 생성한 li  안에 추가한다


  그리고 이제 이 li를! 아까 만든 ul 안에 추가하면 끝

  */

  </script>
</body>
</html>